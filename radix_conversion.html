<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>基数変換トレーニング（ソフトキー対応・Compact）</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{
    --card-w:360px;
    --btn-h:36px;
    --kbd-gap:4px;
  }
  body {
    font-family: "Segoe UI", "メイリオ", sans-serif;
    background: #f2f2f2;
    display: flex;
    justify-content: center;
    align-items: start;
    padding: 14px;
    min-height: 100vh;
    transition: background 0.5s;
  }
  #game {
    width: min(var(--card-w), 96vw);
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
    padding: 10px;
    text-align: center;
  }
  #footer {
    margin-top: 6px;
  }
  h1 {
    font-size: 16px;
    background: #222;
    color: #fff;
    padding: 6px;
    border-radius: 6px;
    margin: 0 0 8px 0;
  }
  .top-row { display:flex; gap:6px; align-items:center; justify-content:space-between; margin-bottom:6px; }
  .info {
    font-size: 11px;
    color: #333;
  }
  select, label { font-size: 12px; }
  .question { margin: 8px 0 2px; font-size: 13px; }
  .number { font-size: 28px; margin: 6px 0; letter-spacing:1px; }
  .answer-row { display:flex; justify-content:center; gap:6px; align-items:center; margin-top:3px; }
  input[type="text"] {
    width: 130px;
    padding: 6px 8px;
    text-align: center;
    font-size: 14px;
    border-radius: 5px;
    border: 1px solid #ccc;
    -webkit-user-select: text;
  }
  #nativeToggle { font-size:11px; margin-left:4px; vertical-align:middle; }
  button.primary {
    padding: 6px 10px;
    font-size: 13px;
    border: none;
    border-radius: 6px;
    background: #2b8bd3;
    color: white;
  }
  button.secondary {
    padding: 6px 10px;
    font-size: 12px;
    border-radius: 6px;
    border: 1px solid #bbb;
    background: #fff;
  }
  .result {
    border-radius: 6px;
    padding: 8px;
    margin-top: 8px;
    background: #eee;
    font-size: 12px;
    min-height: 56px;
    text-align: left;
  }
  .effect-correct { background: #ccf2ff; animation: flash-correct 0.6s ease; }
  .effect-wrong   { background: #ffe6e6; animation: flash-wrong 0.4s ease; }
  @keyframes flash-correct { 0%{background:#9ef} 100%{background:#fff} }
  @keyframes flash-wrong   { 0%{background:#f99} 100%{background:#fff} }

  /* ソフトキーボード */
  .kbd {
    margin-top:8px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--kbd-gap);
  }
  .key {
    height: var(--btn-h);
    border-radius: 6px;
    font-size: 16px;
    border: 1px solid #cfcfcf;
    background: linear-gradient(#fff,#f6f6f6);
    display:flex; align-items:center; justify-content:center;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* A〜Fキーを少し濃い色に */
  .key[data-key="A"],
  .key[data-key="B"],
  .key[data-key="C"],
  .key[data-key="D"],
  .key[data-key="E"],
  .key[data-key="F"] {
   background: linear-gradient(#e6e6ff, #ccccff);
   border-color: #9999ff;
   }
  
  .key:active { transform: translateY(1px); }
  .key.del { background: linear-gradient(#ffecec,#ffdede); border-color:#f3a3a3; }
  .key.enter { grid-column: span 2; background: linear-gradient(#2b8bd3,#1e6fb2); color:#fff; border-color:#186090; }
  .key.clear { background: linear-gradient(#fdf5d6,#fdeaa3); border-color:#f0d24b; font-size:14px; }

  /* レスポンシブ調整 */
  @media (max-width:420px){
    :root{ --btn-h:46px; }
    .number{ font-size:24px; }
    input[type="text"]{ width:120px; font-size:15px; }
  }

  /* 難易度背景カラー */
  .easy-bg { background: #ccffcc; }
  .normal-bg { background: #c1c1ff; }
  .hard-bg { background: #ffa8a8; }
</style>
</head>
<body>

<div id="game">
  <h1>基数変換トレーニング</h1>

  <div class="top-row">
    <div class="info" id="stats">正答率: 0 / 0　スコア: 0</div>
    <div>
      <select id="modeSelect" title="出題モード">
        <option value="7">random</option>
        <option value="1">2→10</option>
        <option value="2">10→2</option>
        <option value="3">2→16</option>
        <option value="4">16→2</option>
        <option value="5">10→16</option>
        <option value="6">16→10</option>
      </select>
      <label style="margin-left:6px;">
        <input type="checkbox" id="levelChk"> 難易度
      </label>
    </div>
  </div>

  <div class="question" id="questionText"></div>
  <div class="number" id="questionNum"></div>

  <div class="answer-row">
    <input type="text" id="answerInput" placeholder="答えを入力" readonly>
    <button class="primary" id="enterBtn">ENTER</button>
    <label id="nativeToggle"><input type="checkbox" id="allowNative"> KB許可</label>
  </div>

  <div class="info" id="levelText">難易度: Easy 4bitまで</div>
  <div class="result" id="resultBox">まだ回答していません</div>

  <!-- ソフトキーボード -->
  <div class="kbd" id="softKbd">

    <div class="key" data-key="A">A</div>
    <div class="key" data-key="B">B</div>
    <div class="key" data-key="C">C</div>
    <div class="key del" id="delKey">Del</div>

    <div class="key" data-key="7">7</div>
    <div class="key" data-key="8">8</div>
    <div class="key" data-key="9">9</div>
    <div class="key" data-key="D">D</div>

    <div class="key" data-key="4">4</div>
    <div class="key" data-key="5">5</div>
    <div class="key" data-key="6">6</div>
    <div class="key" data-key="E">E</div>

    <div class="key" data-key="1">1</div>
    <div class="key" data-key="2">2</div>
    <div class="key" data-key="3">3</div>
    <div class="key" data-key="F">F</div>

    <div class="key clear" id="clearKey">Clear</div>
    <div class="key" data-key="0">0</div>
    <div class="key wide enter" id="kbdEnter">ENTER</div>

  </div>

  <div class="info" id="footer">&#169; 2025 Ibaraki Technology High School</div>
</div>

<script>
let x, mode, level_mode=1, set_mode=7;
let score=0, correctRate=0, total=0;
let old_x=0, old_intext="";

const qText = document.getElementById("questionText");
const qNum = document.getElementById("questionNum");
const input = document.getElementById("answerInput");
const resultBox = document.getElementById("resultBox");
const stats = document.getElementById("stats");
const levelChk = document.getElementById("levelChk");
const levelText = document.getElementById("levelText");
const modeSelect = document.getElementById("modeSelect");
const enterBtn = document.getElementById("enterBtn");
const allowNative = document.getElementById("allowNative");

init();

function init(){
  mode = Math.floor(Math.random()*6)+1;
  x_random();
  updateQuestion();
}

function updateQuestion(){
  const questions = [
    "問）次の２進数を１０進数に変換しなさい。",
    "問）次の１０進数を２進数に変換しなさい。",
    "問）次の２進数を１６進数に変換しなさい。",
    "問）次の１６進数を２進数に変換しなさい。",
    "問）次の１０進数を１６進数に変換しなさい。",
    "問）次の１６進数を１０進数に変換しなさい。"
  ];
  qText.textContent = questions[mode-1] || "";
  if(mode==2||mode==5) qNum.textContent = x.toString(10);
  if(mode==1||mode==3) qNum.textContent = x.toString(2);
  if(mode==4||mode==6) qNum.textContent = x.toString(16).toUpperCase();
  levelText.textContent = (level_mode==1) ? "難易度: Easy 4bitまで" :
                          (level_mode==2) ? "難易度: Normal 7bitまで" : "難易度: Hard 8bit以上";
  document.body.className = level_mode==1?"easy-bg":level_mode==2?"normal-bg":"hard-bg";
}
  
/* 出題範囲を設定 */
function x_random(){
  if(level_mode==1){x=intRand(2,15);}
  if(level_mode==1 && (mode==5||mode==6)){x=intRand(10,15);}
  if(level_mode==2){x=intRand(16,127);}
  if(level_mode==3){x=intRand(128,511);}
}
function intRand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function correctAnswer(){
  switch(mode){
    case 1: return x.toString(10);
    case 2: return x.toString(2);
    case 3: return x.toString(16).toUpperCase();
    case 4: return x.toString(2);
    case 5: return x.toString(16).toUpperCase();
    case 6: return x.toString(10);
  }
}
function baseLabel(n){
  if(n===2) return "(2進数)";
  if(n===10) return "(10進数)";
  if(n===16) return "(16進数)";
}

function judgeAnswer(){
  const ans = input.value.trim();
  old_x = x;
  old_intext = ans;
  let correct = false;
  try{
    if(mode==1||mode==6){ correct = (x==parseInt(ans,10)); }
    if(mode==2||mode==4){ correct = (x==parseInt(ans,2)); }
    if(mode==3||mode==5){ correct = (x==parseInt(ans,16)); }
  }catch(e){ correct=false; }
  return correct;
}

function enterPush(){
  if(!input.value.trim()) return;
  const correct = judgeAnswer();
  total++;
  const correctAns = correctAnswer();
  let fromBase, toBase;
  switch(mode){
    case 1: fromBase=2; toBase=10; break;
    case 2: fromBase=10; toBase=2; break;
    case 3: fromBase=2; toBase=16; break;
    case 4: fromBase=16; toBase=2; break;
    case 5: fromBase=10; toBase=16; break;
    case 6: fromBase=16; toBase=10; break;
  }
  const html = `${baseLabel(fromBase)} ${formatNum(old_x, fromBase)} → ${baseLabel(toBase)} ${correctAns}<br>
                あなたの解答：<b>${old_intext}</b>`;
  if(correct){ correctRate++; score+=getPoint(); effect("correct");
    resultBox.innerHTML=`<b style="color:green;">○ 正解！</b><br>${html}`;
  } else {
    effect("wrong");
    resultBox.innerHTML=`<b style="color:red;">× 不正解！</b><br>${html}`;
  }
  stats.textContent = `正答率: ${correctRate} / ${total}　スコア: ${Math.floor(score)}`;
  input.value="";
  if(set_mode==7){ mode=Math.floor(Math.random()*6)+1; } else { mode=set_mode; }
  if(levelChk.checked){
    if(Math.random()<0.05){ level_mode=3; } else { level_mode=2; }
  }else level_mode=1;
  x_random();
  updateQuestion();
}

function formatNum(val, base){
  if(base==2) return val.toString(2);
  if(base==10) return val.toString(10);
  if(base==16) return val.toString(16).toUpperCase();
}
function getPoint(){
  if(level_mode==1) return 1;
  if(level_mode==2) return 8;
  if(level_mode==3) return 18;
}
function effect(t){
  resultBox.classList.remove("effect-correct","effect-wrong");
  void resultBox.offsetWidth;
  resultBox.classList.add(t==="correct"?"effect-correct":"effect-wrong");
}

enterBtn.addEventListener("click", enterPush);
input.addEventListener("keydown", e=>{
  if(allowNative.checked && e.key==="Enter") enterPush();
  else if(!allowNative.checked) e.preventDefault();
});
modeSelect.addEventListener("change", ()=>{
  set_mode=parseInt(modeSelect.value);
  mode=set_mode==7?Math.floor(Math.random()*6)+1:set_mode;
  x_random(); updateQuestion();
});
levelChk.addEventListener("change", ()=>{
  level_mode = levelChk.checked?2:1;
  updateQuestion();
});
allowNative.addEventListener('change', ()=>{
  if(allowNative.checked){ input.removeAttribute('readonly'); input.focus();}
  else{ input.setAttribute('readonly','true'); input.blur();}
});

const kbd=document.getElementById('softKbd');
kbd.addEventListener('click', ev=>{
  const keyDiv=ev.target.closest('.key'); if(!keyDiv) return;
  const k=keyDiv.dataset.key;
  if(k===undefined){
    if(keyDiv.id==='delKey') delChar();
    if(keyDiv.id==='kbdEnter') enterPush();
    if(keyDiv.id==='clearKey') clearInput();
    return;
  }
  insertChar(k);
});
document.getElementById('delKey').addEventListener('touchstart', e=>{e.preventDefault();delChar();});
document.getElementById('kbdEnter').addEventListener('touchstart', e=>{e.preventDefault();enterPush();});
document.getElementById('clearKey').addEventListener('touchstart', e=>{e.preventDefault();clearInput();});

function insertChar(ch){
  const cur=input.value||"";
  if(cur.length>=16) return;
  input.value=cur+ch.toUpperCase();
}
function delChar(){ input.value=(input.value||"").slice(0,-1); }
function clearInput(){ input.value=""; }

input.setAttribute('readonly','true');
updateQuestion();
</script>
</body>
</html>

